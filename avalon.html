<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/normalize.css" type="text/css">
  <link rel="stylesheet" href="css/skeleton.css" type="text/css">
  <link rel="stylesheet" href="css/styles.css" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68221124-1', 'auto');
    ga('send', 'pageview');

  </script>
  <title>Resistance</title>
</head>

<body>
  {{> main}}
</body>

<template name="main">
  <div class="container">
    {{> score}}
    <br>
    {{> Template.dynamic template=whichView}}
    <hr>

    {{> footer}}
  </div>
</template>

<template name="footer">
  <p class="small"><a href="https://boardgamegeek.com/boardgame/41114/resistance">The Resistance</a> was designed by Don Eskridge</p>
  <p class="small">Built by <a href="http//alantran.co">Alan Tran</a></p>

</template>

<template name="score">
  {{#if game}}
    <div class="score">
      <div class="score-box {{#if roundFinished round=1}}{{roundFinished round=1}}{{/if}}"><p>{{missionNum round=1}}</p></div>
      <div class="score-box {{#if roundFinished round=2}}{{roundFinished round=2}}{{/if}}"><p>{{missionNum round=2}}</p></div>
      <div class="score-box {{#if roundFinished round=3}}{{roundFinished round=3}}{{/if}}"><p>{{missionNum round=3}}</p></div>
      <div class="score-box {{#if roundFinished round=4}}{{roundFinished round=4}}{{/if}}"><p>{{missionNum round=4}}</p></div>
      <div class="score-box {{#if roundFinished round=5}}{{roundFinished round=5}}{{/if}}"><p>{{missionNum round=5}}</p></div>
    </div>
  {{/if}}
</template>

<template name="startMenu">
  <div class="main-menu">
    <h2>Welcome to the Resistance</h2>
    <br>
    <div class="button-container">
      <button class="button-new-game">New Game</button>
      <button class="button-join-game">Join Game</button>
    </div>

  </div>
</template>

<template name="newGame">
  <div class="new-game">
    <h2>New Game</h2>

    <form class="new-game-form">
      <input class="name-input" type="text" placeholder="Name">
      <div class="button-container">
        <button class="button-create">Join</button>
        <button class="button-main-menu">Back</button>
      </div>
    </form>
  </div>
</template>

<template name="joinGame">
  <div class="join-game">
    <h2>Join Game</h2>

    <form class="join-game-form">
      <input class="code-input" type="text" placeholder="Access Code">
      <input class="name-input" type="text" placeholder="Name">

      <div class="button-container">
        <button type="submit" class="button-join">Join</button>
        <button class="button-main-menu">Back</button>
      </div>
    </form>

  </div>
</template>

<template name="lobby">
  <div class="lobby">
    <h2>Lobby</h2>
    <div class="lobby-info">
      <div class="access-code">
        <p>Access Code: {{code}}</p>
      </div>
      <div class="game-options">
        <p class="options-header">Options</p>
        <div class="role-options">
          <li class="checked"><input type="checkbox" class="merlin" checked="{{merlin}}"><span>Merlin</span></li>
          <li class="checked"><input type="checkbox" class="assassin" checked="{{assassin}}"><span>Assassin</span></li>
          <li class="checked"><input type="checkbox" class="morgana" checked="{{morgana}}"><span>Morgana</span></li>
          <li class="checked"><input type="checkbox" class="percival" checked="{{percival}}"><span>Percival</span></li>
        </div>
      </div>
    </div>
    <ul>
      {{#each players}}
        <li>{{ name }}</li>
      {{/each}}
    </ul>

    <div class="button-container">
      <button class="button-start">Start</button>
      <button class="button-leave">Leave</button>
    </div>
    <p class="player-alert-5">You must have at least 5 players to play!</p>
    <p class="player-alert-10">You can't have more than 10 players to play!</p>
  </div>

  <script>
    $(document).ready(function () {
      $('.options-header').click(function () {
        $('.role-options').toggle();
      })
    })
  </script>
</template>

<template name="rolePhase">
  <div class="role-phase">
    <h2>Role Phase</h2>
    <p>Your team: {{player.team}}</p>

    {{#if isSpy}}
    <p> Also on your team:
      {{#each allSpies}}
        <b>{{name}} </b>
      {{/each}}
    </p>
    {{/if}}

    {{#if isMerlin}}
      <p> You are Merlin! The spies are:
        {{#each allSpies}}
        <b>{{name}} </b>
        {{/each}}
      </p>
    {{/if}}

    {{#if isPercival}}
      <p>You are Percival! Merlin is {{possibleMerlins}}.</p>
    {{/if}}

    {{#if isAssassin}}
    <p>You are the assassin! Try to see if you can spot who the Merlin is. You'll have a chance to identify him at the end of the game to win it.</p>
    {{/if}}

    {{#if role}}
      <p>Your special role: {{role}}</p>
    {{/if}}

    <p><b>Ready up!</b></p>
    <ul>
      {{#each players}}
        <li class="{{#if ready}}ready{{/if}}">{{name}}</li>
      {{/each}}
    </ul>
    <button type="submit">Ready</button>
  </div>
</template>

<template name="pickPhase">
  <style media="screen">
  </style>
  <div class="pick-phase">
    <h2>Pick Phase</h2>
    {{> voteResults}}

    {{#if chosenPlayers}}
      <p>Your leader has chosen: </p>
      {{#each chosenPlayers}}
        <li>{{name}}</li>
      {{/each}}
    {{/if}}
    {{#if chosen}}
      <p>You have been chosen!</p>
    {{else}}
      <p>Please wait while your leader chooses a team.</p>
    {{/if}}
  </div>
</template>

<template name="pickPhaseLeader">
  <style media="screen">
    {{#if chosen}}
      body {
        background-color: blue;
      }
    {{/if}}
  </style>
  <div class="pick-phase">
    <h2>Pick Phase</h2>
    {{> voteResults}}

    <p><b>You are the leader!</b> Tap on the names to choose a team.</p>
    <ul>
      {{#each players}}
        {{> player}}
      {{/each}}
    </ul>
    <button class="{{#if pickMax}}ready{{/if}}">Submit</button>
  </div>
</template>

<template name="player">
  <li class="player {{#if chosen}}chosen{{/if}}">
    {{name}}
  </li>
</template>

<template name="votingPhase">
  <div class="voting-phase">
    <h2>Voting Phase</h2>
  </div>

  <p><b>Current Team</b></p>
  <ul>
    {{#each chosenPlayers}}
      <li>{{name}}</li>
    {{/each}}
  </ul>

  <p><b>Waiting for {{ playersCount }} people to vote.</b></p>

  {{#if playerVote}}
    <p>You are voting: {{ playerVote }}</p>
  {{/if}}

  <div class="button-container">
    <button class="button-accept">Accept</button>
    <button class="button-reject">Reject</button>
  </div>
</template>

<template name="missionPhase">
  <div class="mission-phase">
    <h2>Mission Phase</h2>

    {{> voteResults}}
  </div>
</template>

<template name="missionPhaseChosen">
  <div class="mission-phase">
    <h2>Mission Phase</h2>

    {{> voteResults}}

    <div class="button-container">
      <button class="button-pass">Pass</button>
      <button class="button-fail">Fail</button>
    </div>
  </div>
</template>

<template name="voteResults">
  {{#if missionExists}}
      <p>
        The previous mission {{missionResult}}. {{#if numSabotaged}} {{numSabotaged}} sabotaged the mission. {{/if}}
      </p>
  {{/if}}

  {{#if exists}}
    <span id="voteHeader"><h2>Previous Vote Results</h2>(tap to show/hide results)</span>

    <div id="voteResults">
      <div class="voteContainer">
        <div class="voteSubContainer">
          <div>
            <p><b>Voted to accept:</b></p>
          </div>
          <div class="voters">
            <ul>
              {{#each acceptVoters}}
                <li class="voter">{{name}}</li>
              {{/each}}
            </ul>
          </div>
        </div>

        <hr>

        <div class="voteSubContainer">
          <div>
            <p><b>Voted to reject:</b></p>
          </div>
          <div class="voters">
            <ul>
              {{#each rejectVoters}}
                <li class="voter">{{name}}</li>
              {{/each}}
            </ul>
          </div>
        </div>
      </div>
    </div>
  {{/if}}

  <script>
  $(document).ready(function () {
    $('#voteHeader').click(function () {
      $('#voteResults').toggle();
    })
  })
  </script>
</template>

<template name="gameOver">
  <div class="gameOver">
    <p>
      GameOver
    </p>
  </div>
</template>
